<script type="text/javascript">
    function delete_row(elem) {
        var x = dynTableRow(elem);
        var table = document.getElementById('dyn_table');
        var table_length = table.rows.length;
        for (var i = 0; i < table_length - 1; i++) {
            if (table_length > 2) {
                dynTableDeleteRow(x);
                dynTableGetNodeInRow(table.rows[1], 'plus').className = "dct-icon fa fa-plus-square";
                if (!!dynTableGetNodeInRow(table.rows[1], 'drugDId').value && dynTableGetNodeInRow(table.rows[1], 'drugDId').value != "undefined") {
                    dynTableGetNodeInRow(table.rows[1], 'del_saleR').className = "";
                } else {
                    dynTableGetNodeInRow(table.rows[1], 'del_saleR').className = "dct-icon fa fa-minus-circle";
                }
                calculation(elem);
            }
        }
    }
    function clearAll() {
        document.getElementById("batchNo").innerHTML = "";
        document.getElementById("expDate").innerHTML = "";
        document.getElementById("MRP").innerHTML = "";
        document.getElementById("Stkqty").innerHTML = "";
        document.getElementById("edit_retail_form").reset();
    }
    function insert_row(tableid, elem, val) {
        calculation(elem);
        var x = dynTableRow(elem);
        dynTableCloneRow(tableid, x);
        var table = document.getElementById('dyn_table');
        var table_length = table.rows.length;
        for (var i = 0; i < table_length - 1; i++) {
            var skuName = dynTableGetNodeInRow(table.rows[i + 1], 'skuName').value;
            var total = dynTableGetNodeInRow(table.rows[i + 1], 'qty').value;
            if (skuName == "") {
                alert("Enter item name");
                setTimeout(function () {
                    dynTableGetNodeInRow(table.rows[i + 1], 'skuName').focus();
                }, 1);
                return false;
            }
        }
        if (total === "" || parseInt(total) == 0) {
            alert("Enter the Quantity");
            return false;
        }
//        else {   
        var newRow = dynTableAppendRow(tableid);
        if (val == 0) {
            if (dynTableGetNodeInRow(newRow, "skuName").disabled == true) {
                dynTableGetNodeInRow(newRow, "del_saleR").className = "";
            } else {
                dynTableGetNodeInRow(newRow, "del_saleR").className = "dct-icon fa fa-minus-circle";

            }
            dynTableGetNodeInRow(table.rows[1], "plus").className = "dct-icon fa fa-plus-square";
            dynTableGetNodeInRow(newRow, "plus").className = "dct-icon fa fa-plus-square hidden";
            dynTableGetNodeInRow(table.rows[1], "skuName").readOnly = false;
            dynTableGetNodeInRow(table.rows[1], "skuName").disabled = false;
            if (dynTableGetNodeInRow(table.rows[1], "skuName").disabled == false) {
                dynTableGetNodeInRow(table.rows[1], "del_saleR").className = "dct-icon fa fa-minus-circle";
            } else {
                dynTableGetNodeInRow(table.rows[1], "del_saleR").className = "";
            }
            dynTableGetNodeInRow(table.rows[1], "skuName").value = "";
            dynTableGetNodeInRow(table.rows[1], "skuRID").value = "";
            dynTableGetNodeInRow(table.rows[1], "qty").readOnly = false;
            dynTableGetNodeInRow(table.rows[1], "qty").value = '';
            dynTableGetNodeInRow(table.rows[1], "drugDId").value = '';
            dynTableGetNodeInRow(table.rows[1], "drugReqDbillDRid").value = '';
            dynTableGetNodeInRow(table.rows[1], "drugReqDRid").value = '';
            dynTableGetNodeInRow(table.rows[1], "drugReqDItemRID").value = '';
            dynTableGetNodeInRow(newRow, "batchNo").value = dynTableGetNodeInRow(table.rows[1], "batchNo").value;
            dynTableGetNodeInRow(newRow, "issueQty").title = "Already Issued 0";
            dynTableGetNodeInRow(table.rows[1], "expDate").innerHTML = "";
            dynTableGetNodeInRow(table.rows[1], "MRP").innerHTML = "";
            dynTableGetNodeInRow(table.rows[1], "issueQty").title = 'Already Issued 0';
            dynTableGetNodeInRow(table.rows[1], "issueQty").value = '';
            dynTableGetNodeInRow(table.rows[1], "Stkqty").value = "";
            dynTableGetNodeInRow(table.rows[1], "net_amount").value = "";
            dynTableGetNodeInRow(table.rows[1], "batchNo").innerHTML = "";
//                dynTableGetNodeInRow(newRow, "issueQty").onkeypress = return dcomethealth.validation.isNumberKey(event, newRow);
//                dynTableGetNodeInRow(newRow, "issueQty").addEventListener('onkeypress',function(){return dcomethealth.validation.isNumberKey(event, newRow);});
            dynTableGetNodeInRow(table.rows[1], "issuedQty").value = '';
        } else {
            dynTableGetNodeInRow(table.rows[1], "del_saleR").className = "dct-icon fa fa-minus-circle";
            dynTableGetNodeInRow(newRow, "del_saleR").className = "dct-icon fa fa-minus-circle";
            dynTableGetNodeInRow(newRow, "plus").className = "hidden";
            dynTableGetNodeInRow(table.rows[1], "skuName").value = "";
            dynTableGetNodeInRow(newRow, "batchNo").value = dynTableGetNodeInRow(table.rows[1], "batchNo").value;
            dynTableGetNodeInRow(table.rows[1], "expDate").innerHTML = "";
            dynTableGetNodeInRow(table.rows[1], "MRP").innerHTML = "";
            dynTableGetNodeInRow(table.rows[1], "batchNo").value = "";
            dynTableGetNodeInRow(table.rows[1], "Stkqty").value = "";
            dynTableGetNodeInRow(table.rows[1], "net_amount").value = "";

//        dynTableGetNodeInRow(newRow, "del_saleR").className = "dct-icon fa fa-minus-circle"
//        dynTableGetNodeInRow(newRow, "skuName").value = "";
//        dynTableGetNodeInRow(newRow, "batchNo").innerHTML = "";
//        dynTableGetNodeInRow(newRow, "expDate").innerHTML = "";
//        dynTableGetNodeInRow(newRow, "MRP").innerHTML = "";
//        dynTableGetNodeInRow(newRow, "batchNo").value = "";
////        dynTableGetNodeInRow(newRow, "expDate").value = "--Exp Date--";
////        dynTableGetNodeInRow(newRow, "MRP").value = "--MRP--";
//        dynTableGetNodeInRow(newRow, "Stkqty").value = "";
////        dynTableGetNodeInRow(newRow, "qty").value = "";
//        dynTableGetNodeInRow(newRow, "net_amount").value = "";

        }
        dcomethealth.RetailSales.autocomplete();
        dcomethealth.datatypes.init($("#RetailSales"));
    }

    function popup() {
        document.getElementById('discType').value = "";
        document.getElementById('discName').value = "";
        document.getElementById('discVal').value = "";
        document.getElementById('discPercent').value = "";
    }
    function tabKeyPress(e, tableName, event) {
        var keyCode = event.keyCode || event.which;
        if (keyCode == 9) {
            if ($("#h4Header").text() == "Retail Sales") {
                insert_row(tableName, e, 1);
            } else {
                insert_row(tableName, e, 0);
            }
        }
    }

    function calculation() {
        var check = false, checkCostPrice = 0;
        var due = 0;
        var eligibleAmt = $("#bhEligibleAmount").val();
        var gross = 0, net = 0, disc_total = 0, tax_total = 0, serv_tax_total = 0, stkQty = 0;
        var table = document.getElementById('dyn_table');
        var table_length = table.rows.length;
        for (var i = 0; i < table_length - 1; i++) {
            var itemname = dynTableGetNodeInRow(table.rows[i + 1], 'skuName').value;
            var qty_row = dynTableGetNodeInRow(table.rows[i + 1], 'qty').value;
            if (parseInt(dcomethealth.commonInit) == 1) {
                qty_row = dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value;
                stkQty = dynTableGetNodeInRow(table.rows[i + 1], 'Stkqty').value;
                var accQtyRow = dynTableGetNodeInRow(table.rows[i + 1], 'qty').value;
                if (!!qty_row && qty_row != 0) {
                    if ((!stkQty || stkQty == 0)) {
                        alert("Stock qty is less");
                        dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value = "";
                        dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = "";
                        setTimeout(function () {
                            dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').focus();
                        }, 1);
                        return false;
                    }
                    if ((parseInt(qty_row) > parseInt(stkQty))) {
                        alert("Stock qty is less");
                        dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value = "";
                        dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = "";
                        setTimeout(function () {
                            dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').focus();
                        }, 1);
                        return false;
                    }
                    if (!accQtyRow || accQtyRow == 0) {
                        alert("Requested qty is less");
                        dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value = "";
                        dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = "";
                        setTimeout(function () {
                            dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').focus();
                        }, 1);
                        return false;
                    }

                    if (!(isNaN(dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value))) {
                        if (!dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value || parseInt(dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value) == 0) {
                            if (parseInt(qty_row) > parseInt(accQtyRow)) {
                                alert("Requested qty is less");
                                dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value = "";
                                dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = "";
                                setTimeout(function () {
                                    dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').focus();
                                }, 1);
                                return false;
                            }
                        }
                        if (!!dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value && parseInt(dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value) != 0) {
                            var totQty = parseInt(dynTableGetNodeInRow(table.rows[i + 1], 'issuedQty').value) + parseInt(qty_row);
                            if (parseInt(accQtyRow) < totQty) {
                                alert("Requested qty is less");
                                dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').value = "";
                                dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = "";
                                setTimeout(function () {
                                    dynTableGetNodeInRow(table.rows[i + 1], 'issueQty').focus();
                                }, 1);
                                return false;
                            }
                        }
                    }
                }
            }
//            if (!!issue_qty_row && issue_qty_row != 0 && issue_qty_row != 'undefined') {
//                qty_row = issue_qty_row;
//            }
            var mrp_total = dynTableGetNodeInRow(table.rows[i + 1], 'MRP').value;
            var tax_row = dynTableGetNodeInRow(table.rows[i + 1], 'retailTax').value;
            var sal_disc_row = dynTableGetNodeInRow(table.rows[i + 1], 'salDiscount').value;
//            if (itemname == "") {
//                alert("Enter Item Name");
//                return false;
//            }
            if (!qty_row) {
                qty_row = 0;
            }
            if (!tax_row) {
                tax_row = 0;
            }
            if (!sal_disc_row) {
                sal_disc_row = 0;
            }
            if (!mrp_total) { //Need when mrp comes to empty  
                mrp_total = "0";
            }
            var gross_row = parseFloat(qty_row) * parseFloat(mrp_total);
            var tax_calc = parseFloat(gross_row) * (parseFloat(tax_row) / 100);
            tax_total = parseFloat(tax_total) + parseFloat(tax_calc);

            var disc_calc = parseFloat(gross_row) * (parseFloat(sal_disc_row) / 100);
            disc_total = parseFloat(disc_total) + parseFloat(disc_calc);

            gross = parseFloat(gross) + parseFloat(gross_row);
            var net_row = parseFloat(gross_row) - parseFloat(disc_calc) + parseFloat(tax_calc);

            dynTableGetNodeInRow(table.rows[i + 1], 'net_amount').value = net_row.toFixed(2);
            net = parseFloat(net) + parseFloat(net_row);
//            var round = parseInt(net.toFixed(0)) - parseFloat(net);
            var netRound = parseInt(net.toFixed(0)) - parseFloat(net);
            due = net - eligibleAmt;
            var dueRound = parseInt(due.toFixed(0)) - parseFloat(due);
            var round = netRound + dueRound;
        }
        if (due.toString() === "NaN") {
            document.getElementById('serviceDueAmount').value = "";
        } else {
            document.getElementById('serviceDueAmount').value = due.toFixed(0);
        }
        if (gross.toString() === "NaN") {
            document.getElementById('retailGrossAmount').value = "";
        } else {
            document.getElementById('retailGrossAmount').value = gross.toFixed(2);
        }
        if (disc_total.toString() === "NaN") {
            document.getElementById('retailDiscountAmount').value = "";
        } else {
            document.getElementById('retailDiscountAmount').value = disc_total.toFixed(2);
        }
        if (tax_total.toString() === "NaN") {
            document.getElementById('retailTaxAmount').value = "";
        } else {
            document.getElementById('retailTaxAmount').value = tax_total.toFixed(2);
        }
        if (round.toString() === "NaN") {
            document.getElementById('round_off_amount').value = "";
        } else {
            document.getElementById('round_off_amount').value = round.toFixed(2);
        }
        if (net.toString() === "NaN") {
            document.getElementById('retailNetAmount').value = "";
        } else {
            document.getElementById('retailNetAmount').value = net.toFixed(2);
        }
        if (eligibleAmt.toString() === "NaN") {
            document.getElementById('serviceEligibleAmount').value = "";
        } else {
            document.getElementById('serviceEligibleAmount').value = eligibleAmt;
        }
//                    document.getElementById('retailGrossAmount').value = gross.toFixed(2);
//                    document.getElementById('retailDiscountAmount').value = disc_total.toFixed(2);
//                    document.getElementById('retailTaxAmount').value = tax_total.toFixed(2);
//                    document.getElementById('round_off_amount').value = round.toFixed(2);
//                    document.getElementById('retailNetAmount').value = net.toFixed(0);
//                }
//            }
//        }
    }

    function insertRowPay(id, elem) {
        var table = document.getElementById('pmd_table');
        var table_length = table.rows.length;
        for (var i = 0; i < table_length; i++) {
            var total = dynTableGetNodeInRow(table.rows[i], 'pmd_amount').value;
        }
        if (!!total && parseInt(total) !== 0) {
            var x = dynTableRow(elem);
            dynTableCloneRow(id, x);
            var newRow = dynTableAppendRow(id);
            dynTableGetNodeInRow(newRow, "pmd_amount").value = 0;
            dynTableGetNodeInRow(newRow, "cheqno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "bankname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "cheqdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "branchname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "cardtype").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "approvalno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "cardno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "expdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(newRow, "approvalno").value = "";
            dynTableGetNodeInRow(newRow, "bankname").value = "";
            dynTableGetNodeInRow(newRow, "mobileno").value = "";
            dynTableGetNodeInRow(newRow, "cardno").value = "";
            dynTableGetNodeInRow(newRow, "expdate").value = "";
            dynTableGetNodeInRow(newRow, "cheqno").value = "";
            dynTableGetNodeInRow(newRow, "cheqdate").value = "";
            dynTableGetNodeInRow(newRow, "branchname").value = "";
            dynTableGetNodeInRow(newRow, "del").className = 'ace-icon fa fa-minus';
        } else {
            alert("Please enter Amount");
            return false;
        }
    }

    function deleterowPay(elem) {
        var x = dynTableRow(elem);
        dynTableDeleteRow(x);
        pmdPaidSales();
    }

    function div_hide() {
        $("#RetailSalesHeader").removeClass("panel panel-primary").addClass("hidden");
        $("#AddNew").removeClass("hidden").addClass("panel panel-primary");
    }

    function div_back() {
        $("#AddNew").removeClass("panel panel-primary").addClass("hidden");
        $("#RetailSalesHeader").removeClass("hidden").addClass("panel panel-primary");
    }

    function pmdPaidSales() {
        var tab_id = document.getElementById('pmd_table');
        var tab_length = tab_id.rows.length;
        var pmd_amount = dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pmd_amount').value;
        if (!!pmd_amount) {
            var table = document.getElementById('pmd_table');
            var table_length = table.rows.length;
            var pmd_amount_c = 0;
            var pmd_amount1 = 0;
            for (var i = 0; i < table_length; i++) {
                pmd_amount1 = dynTableGetNodeInRow(table.rows[i], 'pmd_amount').value;
                var curRid = dynTableGetNodeInRow(table.rows[i], 'pay_mode_currency').value;
                if (curRid != dcomethealth.sCurrencyRid) {
                    $.each(currencyExchange, function (idx, cur) {
                        if (cur.cerDispCurRid == curRid) {
                            pmd_amount1 = dynTableGetNodeInRow(table.rows[i], 'pmd_amount').value * cur.cerBaseToDispFactor;
                            pmd_amount_c = parseInt(pmd_amount_c) + parseInt(pmd_amount1);
                        }
                    });
                } else {
                    pmd_amount_c = parseInt(pmd_amount_c) + parseInt(pmd_amount1);
                }
            }
            document.getElementById('total_pmd').value = pmd_amount_c.toFixed(2);
        }

    }

    function openCardInfo() {
        var tab_id = document.getElementById('pmd_table');
        var tab_length = tab_id.rows.length;
        var val = dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').value;
        if (dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').options.item(dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').selectedIndex).text == 'Card') {
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "bankname").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "branchname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardtype").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "approvalno").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardno").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "mobileno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "expdate").className = "col-md-12";
        }
        else if (dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').options.item(dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').selectedIndex).text == 'Cheque') {
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqno").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "bankname").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqdate").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "branchname").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "expdate").className = "col-md-12";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "mobileno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardtype").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "approvalno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardno").className = "col-md-12 hidden";
        }
        else if (dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').options.item(dynTableGetNodeInRow(tab_id.rows[tab_length - 1], 'pay_mode_ddict').selectedIndex).text == 'M-pesa') {
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "bankname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "branchname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "expdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardtype").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "approvalno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "mobileno").className = "col-md-12";
        }
        else {
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "mobileno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "bankname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cheqdate").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "branchname").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardtype").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "approvalno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "cardno").className = "col-md-12 hidden";
            dynTableGetNodeInRow(tab_id.rows[tab_length - 1], "expdate").className = "col-md-12 hidden";
        }
    }

    function changeDisc() {
        var discValue = 0, net = 0, roundDisc = 0;
        if ($('#DiscValue').val() == '' && $('#DiscPercent').val() == '') {
            $('#DiscPercent').removeAttr('disabled');
            $('#DiscValue').removeAttr('disabled');
            net = parseInt($('#retailGrossAmount').val());
        } else if ($('#DiscPercent').val() == '' && $('#DiscValue').val() != '') {
            $('#DiscPercent').attr('disabled', 'disabled');
            discValue = parseFloat($('#DiscValue').val());
            if (discValue > parseFloat($('#retailGrossAmount').val())) {
                alert("Entered amount is greater than Gross amount");
                $('#DiscValue').val("");
                return false;
            } else {
                net = parseFloat($('#retailGrossAmount').val()) - parseFloat($('#DiscValue').val());
                var netAmt = $('#retailNetAmount').val();
                roundDisc = parseInt(netAmt) - parseFloat(netAmt);
            }
        } else if ($('#DiscValue').val() == '' && $('#DiscPercent').val() != '') {
            $('#DiscValue').attr('disabled', 'disabled');
            discValue = parseFloat($('#retailGrossAmount').val()) * (parseFloat($('#DiscPercent').val()) / 100);
            net = parseFloat($('#retailGrossAmount').val()) - discValue;
            roundDisc = parseInt(net) - parseFloat(net);
        }
        document.getElementById('retailNetAmount').value = net.toFixed(2)
        document.getElementById('retailDiscountAmount').value = discValue.toFixed(2)
        document.getElementById('round_off_amount').value = roundDisc.toFixed(2);
    }
    function eligibleAmountCalculation() {
        var eligibleAmount = $("#bhEligibleAmount").val(), due = 0;
        if (!!$("#retailNetAmount").val()) {
            if ($("#bhEligibleAmount").val() > $("#retailNetAmount").val()) {
                alert('Eligible amount is greater than Net Amount');
                $("#retailNetAmount").val("");
            } else {
                calculation();
            }

        }
    }
</script>
<div id="RetailSalesHeader" class="panel panel-primary">
    <div id='rs_header' class="panel-heading"><h4 id='h4Header'>Retail Sales</h4>
        <div class="hidden-print">
            <div class="pull-right edit-all-button-container" id="btns_state">                        
                <input type="reset" id="clearForm" class="btn btn-primary" onclick="dcomethealth.util.loadpage('RetailSales');" value="Clear Form" style="margin-top: 3px; margin-bottom: 3px;"/>                    
                <input type="submit" id="saveSubmit" class="btn btn-primary" value="Save" style="margin-top: 3px; margin-bottom: 3px;"/>
            </div>
        </div>
    </div>
    <br>
    <div class="panel panel-default">
        <div class="panel-body col-md-12 col-sm-12 col-xs-12">
            <div class="clearfix">
                <div class="row col-md-6 col-sm-6 col-xs-6">
                    <div>
                        <input id="mrnSearch" type="text" name="mrnSearch" class="col-md-6 form-control" placeholder="UHID / Mobile No." />
                        <input id="billHRID" type="hidden" value=""/>
                        <input id="patientRID" type="hidden" value=""/>
                        <input id="receiptRID" type="hidden" value="0"/>
                        <input id="receiptDRID" type="hidden" value="0"/>
                        <input id="visitRID" type="hidden" value=""/>
                        <input id="visitType" type="hidden" value=""/>
                        <input id="advanceRID" type="hidden" value=""/>
                        <input id="billNo" type="hidden" value=""/>
                        <input id="bhPrefix" type="hidden" value=""/>
                        <input id="bhPrintableBillNo" type="hidden" value=""/>
                        <input id="bhDraftBillNo" type="hidden" value=""/>
                        <input id="bhIsDraft" type="hidden" value=""/>
                        <input id="drugReqHId" type="hidden" value=""/>
                        <input id="drugReqHOpCheck" type="hidden" value=""/>
                        <input id="drugReqHProcedureRid" type="hidden" value=""/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row clearfix col-md-12 col-sm-12 col-xs-12">
                        <span class="text-primary"><strong>Patient Info</strong></span>
                        <div class="row">
                            <div class="row col-md-12 col-sm-12 col-xs-12">                                   
                                <div class="row col-md-4 col-sm-4 col-xs-4">
                                    <span class="text-primary col-md-3 col-sm-3 col-xs-3">Name </span>
                                    <input type="text" id="PatientName" class="col-md-9 col-sm-9 col-xs-9" readonly="readonly"  name="PatientName" style="border: none"/>
                                </div>
                                <div class="row col-md-4 col-sm-4 col-xs-4">
                                    <span class="text-primary col-md-3 col-sm-3 col-xs-3">Age </span>
                                    <input type="text" id="PatientAge" class="col-md-9 col-sm-9 col-xs-9" readonly="readonly" name="PatientAge" style="border: none"/>
                                </div>
                                <div class="row col-md-4 col-sm-4 col-xs-4">
                                    <span class="text-primary col-md-4 col-sm-4 col-xs-4">Contact No </span>
                                    <input type="text" id="PatientMobile" class="col-md-8 col-sm-8 col-xs-8" name="PatientMobile" readonly="readonly" style="border: none"/>
                                </div>
                            </div>
                        </div>
                        <div class="row"></div><br>
                        <span class="text-primary"><strong>payer Info</strong></span><hr class="btn-danger"> 
                        <div class="row col-md-12 col-sm-12 col-xs-12">
                            <div class=" row col-md-2 col-sm-4 col-xs-8">
                                <label>Type</label>
                                <div>
                                    <select id="patRefType" name="patRefType" class=" form-control dcomet-c-s_ddict_payer_type-list jqueryUIToolTip col-md-12 col-sm-12 col-xs-12" title="Payer Type" onchange="dcomethealth.RetailSales.payerChange()">                                       
                                    </select>
                                </div>
                            </div>
                            <div id="payerInfo" class="hidden"> 
                                <div class="col-md-2 col-sm-4 col-xs-8">
                                    <label>Payer Name</label>
                                    <div><select class="col-md-12 form-control" id="payerName" name="payerName" onchange="dcomethealth.RetailSales.payerNameChange(1);"></select></div>
                                </div>          
                                <div id ="eAmountDiv" class="hidden col-md-2 col-sm-4 col-xs-8">
                                    <label>Eligible Amount</label>
                                    <div><input class="col-md-12 form-control" id="bhEligibleAmount" onchange="eligibleAmountCalculation()" onkeypress="return dcomethealth.validation.isNumberKey(event)" name="bhEligibleAmount"/></div>
                                </div>          
                                <div id ="approvalnoDiv" class="hidden col-md-2 col-sm-4 col-xs-8">
                                    <label>Approval Number</label>
                                    <div><input class="col-md-12 form-control" id="bhApprovalNo" name="bhApprovalNo"/></div>
                                </div>          
                            </div>   
                            <div id="doctorName" class=""> 
                                <div class="col-md-2 col-sm-4 col-xs-8 pull-right">
                                    <label>Doctor Name</label>
                                    <div><select class="col-md-12 form-control"  onchange="dcomethealth.CreateOPBill.doctorChange()"  id="VDName" name="VDName"><option value="0"></option></select></div>
                                </div>          
                            </div>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-12"><p></p></div>
                        <div id="issuedDiv" class="col-md-12 col-sm-12 col-xs-12 hidden">
                            <strong><a id="viewIssue" style="cursor: pointer;" class="text-primary">Click issued item</a></strong>
                        </div>                        
                        <div class="col-md-6 col-sm-6 col-xs-6">
                            <table id="issuedDynTable" class="col-md-6 col-sm-6 col-xs-12 table table-condensed hidden">
                                <thead>
                                    <tr>
                                        <th>S.No</th>
                                        <th>Item Name</th>
                                        <th>Issued Qty</th>
                                    </tr>
                                </thead>
                                <tbody id="issuedDynTody"> 
                                    <tr><td></td><td><span id="itemName" class="col-md-11 col-sm-12 col-xs-12"></span></td>
                                        <td><span id="itemIssuedQty" class="col-md-11 col-sm-12 col-xs-12"></span></td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-12 col-sm-12 col-xs-6"><p></p></div>
                        <div class="col-md-12 col-sm-12 col-xs-6">
                            <span class="text-primary"><strong>Item info</strong></span><hr class="btn-danger">
                            <div id="CustomerTable" >
                                <table id="dyn_table" class="col-md-12 col-sm-12 col-xs-12 table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Item Name</th>
                                            <th>Batch No</th>
                                            <th>Exp Date</th>
                                            <th id="salesPriceHead">Cost Price (<span class="dcomet-c-s_currCode"></span>) </th>
                                            <th>Stk Qty</th>
                                            <th id="reqQty">Qty</th>
                                            <th id="iQty" class="hidden">Issue Qty</th>
                                            <th id="disc_head">Disc (%)</th>
                                            <th id="tax_head">Tax (%)</th>
                                            <th>Net (<span class="dcomet-c-s_currCode"></span>)</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="retailTody"> 
                                        <tr>
                                            <td width="1%"><i id="del_saleR" class="dct-icon fa fa-minus-circle hidden" onclick="delete_row(this)"></i></td>
                                            <td width="25%">
                                                <input class="col-md-11 col-sm-12 col-xs-12" type="text" id="skuName" name="skuName" placeholder="Item Name" onchange="dcomethealth.RetailSales.autoIdSet(this)"/>
                                                <input type="hidden" id="skuRID" name="skuRID" />
                                                <input type="hidden" id="billDRID" name="billDRID" value=""/>
                                                <input type="hidden" id="drugDId" name="drugDId" value=""/>
                                                <input type="hidden" id="drugReqDbillDRid" name="drugReqDbillDRid" value=""/>
                                                <input type="hidden" id="drugReqDRid" name="drugReqDRid" value=""/>
                                                <input type="hidden" id="issueQty" name="issueQty" value=""/>
                                                <input type="hidden" id="packageItemRid" name="packageItemRid" value="0">
                                            </td>
                                            <td width="10%">
                                                <select class="col-md-12 col-sm-12 col-xs-12" id="batchNo" name="batchNo" onchange="dcomethealth.RetailSales.onBatchChange(this)">
                                                </select>
                                            </td>
                                            <td width="10%">
                                                <select class="col-md-12 col-sm-12 col-xs-12" id="expDate" name="expDate" onkeypress="return dcomethealth.validation.validateDob(event)" onchange="dcomethealth.RetailSales.onExpiryChange(this)">
                                                </select>
                                            </td>
                                            <td width="10%">
                                                <select class="col-md-12 col-sm-12 col-xs-12" id="MRP" name="MRP" onchange="dcomethealth.RetailSales.onMrpChange(this)"/>
                                                </select> 
                                            </td>
                                            <td width="10%">
                                                <input class="col-md-12 col-sm-12 col-xs-12" id="Stkqty" name="Stkqty" readonly="readonly" onBlur="calculation()"/>
                                            </td>
                                            <td width="10%">
                                                <input class="col-md-12 col-sm-12 col-xs-12" id="qty" type="text" name="qty" maxlength="9" onkeypress="return dcomethealth.validation.isNumberKey(event, this)" autocomplete="off" onBlur="calculation()"><input type="hidden" id="issuedQty" value="0">
                                            </td>
                                            <td width="7%">
                                                <input class="col-md-12 col-sm-12 col-xs-12" id="salDiscount" type="text" name="salDiscount" maxlength="9" onkeypress="return dcomethealth.validation.isDecimalKey(event, this)" autocomplete="off" onBlur="calculation()">
                                            </td>
                                            <td width="7%">
                                                <input class="col-md-12 col-sm-12 col-xs-12" id="retailTax" type="text" name="retailTax" maxlength="9" onkeydown="tabKeyPress(this, 'dyn_table', event)" onkeypress="return dcomethealth.validation.isDecimalKey(event, this)" autocomplete="off" onBlur="calculation()">
                                            </td>
                                            <td width="10%">
                                                <input class="col-md-12 col-sm-12 col-xs-12" type="text" id="net_amount" name="net_amount" readonly="readonly" />
                                            </td>
                                            <td width="1%"><i id="plus" class="dct-icon fa fa-plus-square red" onclick="insert_row('dyn_table', this, 1)"></i></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div id="discountHeader" class="row col-md-12 col-sm-12 col-xs-12">
                            <a data-toggle="modal">
                                <label onclick="$('#viewDiscount').removeClass('hidden')">View Discount</label>
                            </a>
                        </div>
                        <div id="viewDiscount" class="alert alert-success col-md-12 col-sm-12 col-xs-12 hidden">
                            <button type="button" class="close" onclick="$('#viewDiscount').addClass('hidden')">&times;</button>
                            <div class="row col-md-3 col-sm-3 col-xs-3">
                                <label class="row col-md-12 col-sm-12 col-xs-12">Discount Type</label>
                                <select id="DiscType" name="DiscType" class='dcomet-c-s_ddict_discount_type-list jqueryUIToolTip' title="Discount Type"></select>
                            </div>
                            <div class="row col-md-3 col-sm-3 col-xs-3">
                                <label class="row col-md-12 col-sm-12 col-xs-12">Discount Name</label>
                                <input id="DiscName" name="DiscName"/>
                            </div>
                            <div class="row col-md-3 col-sm-3 col-xs-3">
                                <label class="row col-md-12 col-sm-12 col-xs-12">Discount Value (or)</label>
                                <input id="DiscValue" name="DiscValue"  onkeypress="return dcomethealth.validation.isNumberKey(event, this)" onchange="changeDisc()"/> 
                            </div>
                            <div class="row col-md-3 col-sm-3 col-xs-3">
                                <label class="row col-md-12 col-sm-12 col-xs-12">Discount Percentage</label>
                                <input id="DiscPercent" name="DiscPercent" maxlength="3" onkeypress="return dcomethealth.validation.isNumberKey(event, this)" onBlur="changeDisc()" onchange="dcomethealth.validation.isPercentaged(this)"/>
                            </div>
                        </div>
                        <div class="row hidden">
                            <div class="col-md-2 col-sm-3 col-xs-3">
                                <label>Paid(<span class="dcomet-c-s_currCode"></span>)</label>
                                <input type="text" id="billHPaidAmount" name="billHPaidAmount" value="0.00" class="col-md-6 col-sm-6 col-xs-12" readonly style="border: none"/><br>
                            </div>
                            <div class="col-md-2 col-sm-3 col-xs-3">
                                <label>Due (<span class="dcomet-c-s_currCode"></span>)</label>
                                <input type="text" id="billHDueAmount" name="billHDueAmount" class="col-md-6 col-sm-6 col-xs-12" readonly style="border: none"/><br>
                            </div>
                        </div>
                    </div><br>                    

                    <div id="billInformation" style="margin-top: 10px" class="alert alert-info pull-right col-md-12">
                        <div class="col-xs-12 col-md-2 col-sm-6">
                            <div class=""><strong>Gross</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <input type="hidden" id="row_count_lens" name="row_count_lens" />
                                <input type="hidden" id="total_qty_lens" name="total_qty_lens" />                                    
                                <output id="retailGrossAmount" name="retailGrossAmount" class="col-md-3 col-sm-6 col-xs-12"/>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-2 col-sm-6">
                            <div class=""><strong>Tax</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="retailTaxAmount" name="retailTaxAmount" class="col-md-1 col-sm-6 col-xs-12" style="border: none"/>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-2 col-sm-6">
                            <div class=""><strong>Discount</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="retailDiscountAmount" name="retailDiscountAmount" class="col-md-6 col-sm-6 col-xs-12" style="border: none"/>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-2 col-sm-6 hidden">
                            <div class=""><strong>Round Off</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="round_off_amount" name="round_off_amount" class="col-md-6 col-sm-6 col-xs-12" style="border: none"/>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-2 col-sm-6">
                            <div class=""><strong>Nett</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="retailNetAmount" name="retailNetAmount" class="col-md-6 col-sm-6 col-xs-12" style="border: none"/>
                            </div>
                        </div>
                        <div id= "eligibleAmtDiv" class="hidden col-xs-12 col-md-2 col-sm-6">
                            <div class="row"><strong>Payer Amount </strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="serviceEligibleAmount" name="serviceEligibleAmount" class="col-md-6 col-sm-6 col-xs-12"/>
                            </div>
                        </div>                               
                        <div id="dueAmtDiv" class="hidden col-xs-12 col-md-2 col-sm-6">
                            <div class=""><strong>Due </strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                            <div class="">
                                <output id="serviceDueAmount" name="serviceDueAmount" class="col-md-6 col-sm-6 col-xs-12"/>
                            </div>
                        </div>
                        <!--                        <div class="col-xs-12 col-md-2 col-sm-6">
                                                    <div class=""><strong>Total</strong> (<span class="dcomet-c-s_currCode"></span>)</div>
                                                    <div class="">
                                                        <output id="total_pmd" name="total_pmd" class="col-md-6 col-sm-6 col-xs-12" style="border: none"/>
                                                    </div>
                                                </div>-->
                    </div>
                    <div id="paymentDiv" class="col-md-12 alert alert-info">
                        <div id="paymentMode" class="row col-md-12 col-sm-12 col-xs-12">                          
                            <table id="pmd_table" class="table table-condensed table-hover" width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td width="2%"><i id="del" class="ace-icon fa fa-minus hidden" onclick="deleterowPay(this)"></i></td>
                                    <td width="5%" onclick="">
                                        <div class="btn-group">
                                            <select id="pay_mode_ddict" name="pay_mode_ddict" class="dcomet-c-s_ddict_payment_mode-list" onchange="openCardInfo(this)"></select>
                                        </div>
                                    </td>
                                    <td width="8%" id="td_1"><select id="cardtype" name="cardtype" class="dcomet-c-s_ddict_credit_card_type-list col-md-12 hidden" ></select><input class="col-md-12 hidden" id="cheqno" name="cheqno" maxlength="20" onkeypress="return dcomethealth.validation.isNumberKey(event, this)" placeholder="Cheque No"/></td>
                                    <td width="7%" id="td_2"><input class="col-md-12 hidden" id="bankname" name="bankname" placeholder="Bank Name" onkeypress="return dcomethealth.validation.ValidateAlpha(event)"/> </td>
                                    <td width="10%" id="td_3"><input class="col-md-12 hidden" id="approvalno" name="approvalno" placeholder="Approval No." maxlength="20" onkeypress="return dcomethealth.validation.isNumberKey(event)"/><input class="col-md-12 hidden jqueryUIToolTip"  title="MM/YYYY Format" id="cheqdate" name="cheqdate" placeholder="Cheque Date" maxlength="10" onkeypress="dcomethealth.validation.isNumberKey(event, this)" onchange="return dcomethealth.validation.validateDob(this)"/></td>
                                    <td width="10%" id="td_4"><input class="col-md-12 hidden" id="cardno" name="cardno" placeholder="Card No" maxlength="20" onkeypress="return dcomethealth.validation.isNumberKey(event, this)"/><input class="col-md-12 hidden" id="branchname" name="branchname" placeholder="Branch Name" onkeypress="return dcomethealth.validation.ValidateAlpha(event)" /></td>
                                    <td width="8%" id="td_5"><input class="col-md-12 hidden jqueryUIToolTip"  title="MM/YYYY Format" id="expdate" name="expdate" placeholder="Exp Date" maxlength="10" onchange="return dcomethealth.validation.validateDob(this)"/></td>
                                    <td width="8%" id="td_6"><input class="col-md-12 hidden" id="mobileno" name="mobileno" maxlength="12" onkeypress="return dcomethealth.validation.isNumberKey()(this)" placeholder="Mobile No"/></td><input class="col-md-12 hidden" id="mobileno" name="mobileno" maxlength="10" onkeypress="return dcomethealth.validation.validateAlpha()" placeholder="Mobile No"/>
                                <td width="5%" onclick=""><div class="btn-group">
                                        <select id="pay_mode_currency" name="pay_mode_currency" onchange="openCardInfo(this)" >
                                        </select></div>
                                </td>
                                <td width="15%"><input class="input-small width-100" id="pmd_amount" name="pmd_amount" maxlength="9" onkeypress="return dcomethealth.validation.isNumberKey(event, this)" type="text" style="text-align: right" onblur="pmdPaidSales()"/></td>
                                <td width="2%"><i class="ace-icon fa fa-plus" onclick="insertRowPay('pmd_table', this)"></i></td>
                                </tr>
                            </table>                                    
                        </div> 
                        <div class="row col-md-12 col-sm-12 col-xs-12">
                            <table class="table table-condensed table-hover" width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td width="2%"></td>
                                    <td width="5%"></td>
                                    <td width="7%"></td>
                                    <td width="7%"></td>
                                    <td width="10%"></td>
                                    <td width="10%"></td>
                                    <td width="7%"></td>
                                    <td width="8%"></td>
                                    <td width="10%"> <label class=""><strong>Total</strong> (<span class="dcomet-c-s_currCode"></span>)</label></td>
                                    <td width="15%"><input id="total_pmd" class="" name="total_pmd" readonly style="border: none;text-align:right;"/></td>
                                    <td width="2%"></td>
                                </tr>
                            </table>
                        </div>                                              
                    </div>
                </div> 
            </div>
        </div>         
    </div>
</div>
